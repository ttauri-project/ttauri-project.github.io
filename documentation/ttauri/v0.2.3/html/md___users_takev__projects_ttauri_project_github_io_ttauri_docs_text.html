<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TTauri: Text</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TTauri
   &#160;<span id="projectnumber">v0.2.3</span>
   </div>
   <div id="projectbrief">A low latency retained GUI</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Text </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md134"></a>
FontBook initialization</h1>
<p>When the application is started a global FontBook is instanced. During the FontBook's instantiation it will fast-parse each TrueType font in the operating system's font folder.</p>
<p>During the fast-parse the 'name', 'OS/2' and optionally other tables are read and then the font files are closed and memory is freed. This fast-parse is designed to be very fast to reduce impact on application startup time.</p>
<p>The following information gleamed during the fast-parse:</p><ul>
<li>'name' Prefered Font family name; code-16 if available, otherwise code-1</li>
<li>'name' Prefered Font subfamily name: code-17 if available, otherwide code-2</li>
<li>'OS/2' Font weight</li>
<li>'OS/2' Regular/Italic</li>
<li>'OS/2' Serif/Sans-serif</li>
<li>'OS/2' Variable/Monospace</li>
<li>'OS/2' Regular/Condensed</li>
<li>'OS/2' Unicode ranges (as backup the 'cmap' table may be parsed)</li>
<li>'OS/2' The height of 'x' and 'H' (as back the 'glyf' table may be parsed)</li>
</ul>
<p>Each font family is assigned a FamilyID. Each font is assigned a FontID.</p>
<p>There is a list of fallback font families for well known fonts, in case certain font families are not available on the system.</p>
<p>Each font will be assigned a list of fallback fonts for missing glyph lookup. Priority is given for fonts that start with the same font family name. For example "Arial Arabic" will be prioritized when the current font is "Arial"</p>
<h1><a class="anchor" id="autotoc_md135"></a>
Font selection</h1>
<p>A FontVariant consists of a FontWeight+serif-flag. This allows a user to select a font family to draw a text with and emphesize fragments of the text using italic and bold.</p>
<p>There are a total of maximum 20 FontVariants for each FontFamilyID.</p>
<p>Selecting a font to render a text is done in several steps:</p><ul>
<li>A user select a font family name and a FontVariant.</li>
<li>The font family name is looked up in the FontBook and a FontFamilyID is returned for a font that exists on the system which closely matches the requested family.</li>
<li>The FontFamilyID + FontVariant is looked up in the FontBook and a FontID is returned for the variant the closely matches the requested variant that is available for that family.</li>
<li>A grapheme + FontID is looked up in the FontBook and a FontGlyphIDs is returned. The returned FontID may be of another font than requested if the glyphs where not available in the requested fonts.</li>
</ul>
<h1><a class="anchor" id="autotoc_md136"></a>
Text shaping</h1>
<h2><a class="anchor" id="autotoc_md137"></a>
Phases</h2>
<ol type="1">
<li>Given a text and a text-style; calculate the natual size of the text<ul>
<li>Lookup the glyphs and their width.</li>
</ul>
</li>
<li>Given a maximum width fold the text; shape the text.<ul>
<li>Line wrap the text to fit the maximum width.</li>
<li>Execute the Unicode bidrectional algorithm.</li>
<li>Lookup glyphs that have been replaced.</li>
<li>Morph glyphs such as font ligatures</li>
<li>Calculate position of each glyph</li>
</ul>
</li>
<li>Draw the text, possibly replacing the color</li>
<li>Given draw coordinates find character in the original text.</li>
<li>Given a character in the original text find a neighbouring character on the screen.</li>
</ol>
<h2><a class="anchor" id="autotoc_md138"></a>
Sub-styles</h2>
<p>Sub-styles can be selected inline in the text using the following Unicode code-points:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Code   </th><th class="markdownTableHeadLeft">Name   </th><th class="markdownTableHeadLeft">Common Style   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">U+FDD0   </td><td class="markdownTableBodyLeft">Regular   </td><td class="markdownTableBodyLeft">Regular   </td><td class="markdownTableBodyLeft">This is the default regular text    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">U+FDD1   </td><td class="markdownTableBodyLeft">Emphasis   </td><td class="markdownTableBodyLeft">Italic   </td><td class="markdownTableBodyLeft">For different but not more or less imporant than regular text.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">U+FDD2   </td><td class="markdownTableBodyLeft">Strong   </td><td class="markdownTableBodyLeft">Bold or red   </td><td class="markdownTableBodyLeft">For important text like warnings.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">U+FDD3   </td><td class="markdownTableBodyLeft">Light   </td><td class="markdownTableBodyLeft">Light or gray   </td><td class="markdownTableBodyLeft">For less important text, like long explanations.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">U+FDD4   </td><td class="markdownTableBodyLeft">Code   </td><td class="markdownTableBodyLeft">Monospaced   </td><td class="markdownTableBodyLeft">For data, or examples of data.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">U+FDD5   </td><td class="markdownTableBodyLeft">Link   </td><td class="markdownTableBodyLeft">Underlined and blue   </td><td class="markdownTableBodyLeft">For clickable links.   </td></tr>
</table>
<p>These code-points are noncharacter code-point and are used internally of the TTauri library. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.0
</small></address>
</body>
</html>
