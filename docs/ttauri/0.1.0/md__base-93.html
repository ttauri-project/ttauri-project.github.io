<!-- HTML header for doxygen 1.9.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TTauri: Base-93 format</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="version_dropdown.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TTauri
   </div>
   <div id="projectbrief">A low latency retained GUI</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Base-93 format </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The base-93 format is used to encode binary data into ASCII data so that a user is able to copy this data using copy-and-paste from one application to another.</p>
<p>This is for example useful for license code, or for moving snippets of application settings.</p>
<p>The encoding efficiency is calculated as follows:</p><ul>
<li>21 bytes are encoded as 26 base-93 digits</li>
<li>The 26 digits are encapsulated inside SECDEC as 32 characters</li>
<li>2 synchronization characters are appended giving 34 characters</li>
<li>Ratio is 21 Bytes / 34 chars =&gt; 0.62 bytes/character</li>
<li>Ratio is 168 Bits / 34 chars =&gt; 4.94 bits/character</li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
Alphabet</h1>
<p>The base-93 alphabet contains all 94 printable ASCII characters.</p>
<p>The first 93 characters ASCII '!' up to and including '}' represents a base-93 digit. '!' codes the value 0, '}' encodes the value 92.</p>
<p>ASCII '~' character is used to start a command.</p>
<p>All non-printable characters are ignored, characters outside the ASCII range are an error.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Commands</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
Start data</h2>
<p>The characters "~b93{" starts a data section. Character left of "~b93{" are ignored by the decoder, this allows a clear-text description of the data.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
End data</h2>
<p>The characters "~}" stops a data section. Character right of "~}" are ignored by the decoder, this allows a clear-text description of the data.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Base-93 Number</h1>
<p>A base-93 number is 13 characters in length, except for the last number in a message which may be smaller depending on the number of bytes encoded, as shown in the table below:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight">digits </th><th class="markdownTableHeadRight">bits </th><th class="markdownTableHeadRight">bytes </th><th class="markdownTableHeadRight">unused  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">2 </td><td class="markdownTableBodyRight">13 </td><td class="markdownTableBodyRight">1 </td><td class="markdownTableBodyRight">0  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">4 </td><td class="markdownTableBodyRight">26 </td><td class="markdownTableBodyRight">2 </td><td class="markdownTableBodyRight">5  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">5 </td><td class="markdownTableBodyRight">32 </td><td class="markdownTableBodyRight">3 </td><td class="markdownTableBodyRight">3  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">6 </td><td class="markdownTableBodyRight">39 </td><td class="markdownTableBodyRight">4 </td><td class="markdownTableBodyRight">2  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">7 </td><td class="markdownTableBodyRight">45 </td><td class="markdownTableBodyRight">5 </td><td class="markdownTableBodyRight">0  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">9 </td><td class="markdownTableBodyRight">58 </td><td class="markdownTableBodyRight">6 </td><td class="markdownTableBodyRight">5  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">10 </td><td class="markdownTableBodyRight">65 </td><td class="markdownTableBodyRight">7 </td><td class="markdownTableBodyRight">4  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">11 </td><td class="markdownTableBodyRight">71 </td><td class="markdownTableBodyRight">8 </td><td class="markdownTableBodyRight">2  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">12 </td><td class="markdownTableBodyRight">78 </td><td class="markdownTableBodyRight">9 </td><td class="markdownTableBodyRight">1  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">13 </td><td class="markdownTableBodyRight">85 </td><td class="markdownTableBodyRight">10 </td><td class="markdownTableBodyRight">0  </td></tr>
</table>
<p>Constructing a 85 bit unsigned integer from these digits as follows:</p><ol type="1">
<li>For each character left-to-right</li>
<li>multiple the integer with 93, then</li>
<li>add the base-93 value of the character to that integer.</li>
</ol>
<p>The number includes a number of bytes, a 5 bit CRC and unused bits which are set to zero.</p>
<p>We use as basis the CRC-5-USB polynomial <code>x^5 + x^2 + 1</code> which yields a divisor 0b1'00101. Each number of 13 digits and smaller is first converted to an 85 bit unsigned integer and then the location of this number is prepended in front of this integer. The location starts at zero and for each number in the message it is incremented by one.</p>
<p>The checksum is correct when the result is zero in the algorithm below: </p><div class="fragment"><div class="line">uint5_t crc5_base93(uint85_t decoded_number, uint32_t location) {</div>
<div class="line">    auto result = location &lt;&lt; 85 | decoded_number;</div>
<div class="line">    auto divisor = 0b100101 &lt;&lt; 111;</div>
<div class="line"> </div>
<div class="line">    for (auto i = 0; i &lt; 111; i++) {</div>
<div class="line">        result ^= divisor;</div>
<div class="line">        divisor &gt;&gt;= 1;</div>
<div class="line">    }</div>
<div class="line">    return result;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The bytes are extracted from the number with the following algorithm: </p><div class="fragment"><div class="line">auto extract_bytes_base93(uint85_t decoded_number, int nr_bytes) {</div>
<div class="line">    std::string result;</div>
<div class="line"> </div>
<div class="line">    decoded_number &gt;&gt;= 5;</div>
<div class="line">    for (auto i = 0; i &lt; nr_bytes; i++) {</div>
<div class="line">        result += static_cast&lt;char&gt;(decoded_number &amp; 0xff);</div>
<div class="line">        decoded_number &gt;&gt;= 8;</div>
<div class="line">    }</div>
<div class="line">    return result;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.0-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" width="104" height="31" alt="doxygen"/></a> 1.8.17
</small></address>
</body>
</html>
