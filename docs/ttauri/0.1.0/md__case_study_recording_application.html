<!-- HTML header for doxygen 1.9.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TTauri: Case Study: Recording Application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="version_dropdown.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TTauri
   </div>
   <div id="projectbrief">A low latency retained GUI</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Case Study: Recording Application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The application will need to run on:</p>
<ul>
<li>Windows 10</li>
<li>Mac OS</li>
<li>iOS</li>
<li>Android</li>
</ul>
<p>The user interface needs to be silky smooth with real time updates for the audio related user interface elements like audio meters, spectrum analyser, waveform viewer.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
GUI Library</h1>
<h2><a class="anchor" id="autotoc_md20"></a>
Compositing</h2>
<p>Use Vulkan for compositing pre-drawn user interface elements at variable positions and rotation. Share pre-drawn layers between elements that are equal to composite them multiple times at different positions and rotations.</p>
<p>All compositing commands should be properly sorted based on type, to improve rendering/compositing speed, in the same way as game graphic engines. Use Z buffering for compositing to sort by type even for overlapping user interface elements.</p>
<p>In principle the user interface is redrawn completely every buffer-swap, i.e. 60 fps. A background cached texture map can be used to draw all fixed elements in a single draw with just clearing the Z buffer. Changed opaque elements can draw directly on top of cached texture map without clearing the texture map, however all sub elements need to be redrawn above that (how to handle clearing of the Z buffer in this case).</p>
<h2><a class="anchor" id="autotoc_md21"></a>
Realtime Drawing</h2>
<p>Drawing of simple shapes like lines, boxes, circles can be done directly with triangles and simple fragment shaders including anti-aliasing.</p>
<p>Drawing of real time text can be done using glyph cached texture map on top of triangles. Use libfreetype to render directly into a high resolution bitmap, and pass it to Vulkan using <code>VK_FORMAT_R16_UINT</code> 4x4 pixel per texel then use super-sampling when compositing.</p>
<h2><a class="anchor" id="autotoc_md22"></a>
Path Rendering</h2>
<p>For comercial exploitation of the GUI Toolkit I want to implement 2D path rendering in the toolkit itself. TrueType fonts are pretty easy to read and render needing only quadratic-bezier-paths. However doing scanline rendering is more computational efficient than fragment rendering, since ray-casting over the y-axis allows for a lot of pre computation. The rest of the path rendering can be build on top of the font render engine, including pixel hinting.</p>
<p>For the first version use Cairo and Pango to draw anti-aliased black-and-white textures that are then composited using my own engine.</p>
<h1><a class="anchor" id="autotoc_md23"></a>
API/Classes</h1>
<h2><a class="anchor" id="autotoc_md24"></a>
Image</h2>
<ul>
<li>width, height</li>
<li>origin-x,y (compared to left top of image).</li>
<li>Reference to Vulkan Image Handle</li>
<li>Reference to data mapping.</li>
</ul>
<p>An image can be loaded from disk using the .png format. The memory format is equal to Vulkan's image format and can be mapped directly from the GPU.</p>
<h2><a class="anchor" id="autotoc_md25"></a>
ImageEffects</h2>
<p>Effects that can be executed on a full color or gray-scale image,</p>
<ul>
<li>Gaussion blur</li>
<li>Matte Composit (Select between two source from the list)<ul>
<li>Image</li>
<li>Fill solid colour</li>
<li>Fill linear gradiant</li>
<li>Fill radial gradiant</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md26"></a>
Path</h2>
<p>A path is build up from quadratic-bezier curves which can be filled or stroked into an gray-scale <code>Image</code> for matte purpose. Specification according to TrueType Fonts, which includes hinting.</p>
<p>Store all bezier curves in a 1D table. Use fragment shader to pre- compute the y-axis parameters into a 2D table. Use a second fragment shader to compute inside/distance test for each pixel from this 2D table. How many y-axis parameters are needed? How well does Vulkan handle non-square non-power-of-two images?</p>
<h2><a class="anchor" id="autotoc_md27"></a>
Font</h2>
<p>A font is a collection of <code>Paths</code>.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
ImageCopyCommand</h2>
<ul>
<li>x,y vector from origin of destination to origin of <code>Image</code>.</li>
<li>rotation around z-axis at origin of <code>Image</code>.</li>
<li>z-depth for depth test.</li>
<li>Image</li>
<li>Super sampling required when doing non-integer moves or rotations.</li>
</ul>
<h2><a class="anchor" id="autotoc_md29"></a>
ImageCopyCommandQueue</h2>
<p>Queue of image-copy-commands to execute on each frame. All ImageCopyCommand share the shader, but some commands need super-sampling, there should be two physical queues to seperate the two different Vulkan pipelines that are needed.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
RealTimeDrawCommand</h2>
<ul>
<li>Triangle Data, including colour.</li>
<li>Use super sampler for anti-aliased lines.</li>
</ul>
<h2><a class="anchor" id="autotoc_md31"></a>
RealTimeDrawCommandQueue</h2>
<p>All draw commands share the same vulkan pipeline for drawing of solid shapes.</p>
<h2><a class="anchor" id="autotoc_md32"></a>
Widget</h2>
<ul>
<li>static data (incl width, height).</li>
<li>implements key for HashMap based on static-data.</li>
<li>shared between multiple <code>WidgetCell</code>.</li>
<li>Manages Images</li>
</ul>
<p>The Widget draws the images needed by a WidgetCell. Draws images lazilly, cheaper for WidgetCache.</p>
<p>A Widget's static data is immutable after creation. Images are created purely based on its static data.</p>
<h2><a class="anchor" id="autotoc_md33"></a>
WidgetCache</h2>
<ul>
<li>Tracks sharing of Widgets with equal static-data.</li>
<li>wantToUseWidget(Widget) -&gt; Widget</li>
<li>finishedUsingWidget(Widget) Every Widget needs to be moved through the WidgetCache, which may return a prefiously created Widget in return. If a WidgetCell needs a change a Widget it needs to create a new Widget and return the old one to the Cache.</li>
</ul>
<h2><a class="anchor" id="autotoc_md34"></a>
WidgetCell</h2>
<ul>
<li>References Widget for drawing of shared static images.</li>
<li>Creates and manages ImageCopyCommands using variable data.</li>
<li>Creates and manages RealTimeDrawCommands using variable data.</li>
<li>variable data (incl x,y coords)</li>
<li>Every WidgetCell can be a container for other WidgetCells.</li>
<li>Animate between values of variable data, such as the X-Y coord.</li>
<li>Track mouse events into bounding shapes (rectangle, circle).</li>
<li>Track Tap, shift-tap keyboard-focus switching between children and pass back to parent.</li>
</ul>
<h2><a class="anchor" id="autotoc_md35"></a>
Window</h2>
<p>An application can open one or more windows. An application can have one or more of the windows in fullscreen-borderless.</p>
<p>An application wants to open small always-ontop-of-application windows for panels which can embed as a widget inside another window.</p>
<p>Resize in Vulkan is expensive requiring building of a new surface, swap-buffers queues, etc. After resize Widgets may need to be re-created and re-drawn based on the new size.</p>
<p>Interact with Mac OS's top-of-screen main menu.</p>
<p>May need to open operating system supplied dialogue-windows, such as open-file dialogue to interact with the sandbox environment. Other operating system supplied dialogues: Colour-palette, Font-selector, Media-selector, Address-book.</p>
<p>The operating system may also open modal permission dialogue windows, for example when using the audio input, address book, camera.</p>
<h1><a class="anchor" id="autotoc_md36"></a>
External Libraries needed</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Library </th><th class="markdownTableHeadNone">License </th><th class="markdownTableHeadNone">Commercial </th><th class="markdownTableHeadNone">Dependencies  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Vulkan </td><td class="markdownTableBodyNone">Apache License 2.0 </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">VulkanSamples </td><td class="markdownTableBodyNone">Apache License 2.0 </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">cereal </td><td class="markdownTableBodyNone">BSD </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone">-  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">glslang </td><td class="markdownTableBodyNone">Google (BSD-like), NVIDIA (MIT-like) </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone">-  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SPIRV-Cross </td><td class="markdownTableBodyNone">Apache License 2.0 </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SPIRV-Tools </td><td class="markdownTableBodyNone">Apache License 2.0 </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SPIRV-Headers </td><td class="markdownTableBodyNone">Kronos (BSD Like) </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">MoltenVK </td><td class="markdownTableBodyNone">Apache License 2.0 </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone">cereal, SPIRV, glslang, Vulkan, VulkanSamples  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">libfreetype </td><td class="markdownTableBodyNone">FTL (BSD Like) / GPL2 </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone">-  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Pango </td><td class="markdownTableBodyNone">LGPL 2 </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone">Cairo, Fontconfig  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Fontconfig </td><td class="markdownTableBodyNone">MIT </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone">Freetype  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Cairo </td><td class="markdownTableBodyNone">LGPL 2.1 </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone">libpng, pixman, Fontconfig  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">libpng </td><td class="markdownTableBodyNone">zlib/libpng </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone">-  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">pixman </td><td class="markdownTableBodyNone">MIT </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone">-  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md37"></a>
Data Controller</h1>
<p>A data-controller maintains a set of values that can be simultaneous controlled and queried by user interface elements, physical controls, or other devices.</p>
<p>User interface elements may need to change visually when data changes. And the user interface element should be able to change data when the user controls the user interface element.</p>
<p>Some values may need to be locked, such as the sample rate, the value will try to force the locked value or give and error if it is not possible to force the value. The user interface element or physical feedback should display an error (possibly using an error sound).</p>
<p>The 'configure' (right click) menu of a user interface element will show information about the data-controller that is linked to it, including other user interface elements or physical controls. This way it is possible to link other user interface elements, physical controls and devices directly from the user interface element.</p>
<h1><a class="anchor" id="autotoc_md38"></a>
Needed user interface elements</h1>
<h2><a class="anchor" id="autotoc_md39"></a>
Window / Panel</h2>
<p>The application may be one or more windows, full screen, on multiple screens.</p>
<h2><a class="anchor" id="autotoc_md40"></a>
Text Label</h2>
<p>Drawing ASCII text with real time update with for example time code with display characters using a mono-font.</p>
<p>Non-cached rendering.</p>
<ul>
<li>Also used as tumbler for setting values.</li>
</ul>
<h2><a class="anchor" id="autotoc_md41"></a>
Text Input Field</h2>
<p>User editable text.</p>
<ul>
<li>Unicode with right-to-left support.</li>
<li>Single or multiple line.</li>
<li>Template place holders which can be dragged and configured.</li>
<li>Turning editing off can be used as static label.</li>
<li>Horizontal, Vertical, Diagonal.</li>
<li>Spell check.</li>
</ul>
<h2><a class="anchor" id="autotoc_md42"></a>
Pull Down Menu</h2>
<p>Menu items are widgets, including the pull down menu itself. Normal items are Buttons with text.</p>
<h2><a class="anchor" id="autotoc_md43"></a>
Button</h2>
<p>Custom Drawing, or fixed images/text. May show multiple states at once.</p>
<ul>
<li>On/Off</li>
<li>Check Box</li>
<li>Radio Button</li>
<li>"Recording"</li>
</ul>
<h2><a class="anchor" id="autotoc_md44"></a>
Slider / Knob</h2>
<p>Real time update of slider position, or knob rotation on top of a static background.</p>
<h2><a class="anchor" id="autotoc_md45"></a>
2D Table</h2>
<ul>
<li>Scrolling.</li>
<li>Add row / delete row buttons.</li>
<li>Widgets in each cell.</li>
</ul>
<h2><a class="anchor" id="autotoc_md46"></a>
Assignment Grid</h2>
<p>A grid to assign inputs to channels, channels to outputs, channels to files, files to folders. Temporary, I don't like this user interface in Boom Recorder, replace with drag/drop grid?</p>
<h2><a class="anchor" id="autotoc_md47"></a>
Tabs</h2>
<p>Container that switches between tabs.</p>
<h2><a class="anchor" id="autotoc_md48"></a>
Ring Buffer viewer</h2>
<p>Show the status of the ring buffer and audio I/O.</p>
<h2><a class="anchor" id="autotoc_md49"></a>
Audio Meter</h2>
<p>Show audio levels:</p>
<ul>
<li>True-peak</li>
<li>Loudness level</li>
<li>Peak and hold</li>
<li>Maximum peak (resettable).</li>
<li>Enabled</li>
<li>Armed</li>
<li>Multiple channels</li>
<li>Configurable red, yellow, green areas</li>
</ul>
<h2><a class="anchor" id="autotoc_md50"></a>
Spectrum Analyser</h2>
<ul>
<li>Frequency decades or Octave grid</li>
<li>Configurable lowest and highest level.</li>
</ul>
<h2><a class="anchor" id="autotoc_md51"></a>
Timeline/Waveform viewer</h2>
<p>Show recordings throughout the day on a single timeline.</p>
<ul>
<li>Current recording point</li>
<li>Current listening point</li>
<li>Peak/Loudness level of multi/channels</li>
<li>Start / Stop points of recordings.</li>
<li>Collapse between Stop and Start.</li>
<li>Shows recording metadata above Start/Stop points</li>
<li>Shows clipping</li>
<li>Shows missing samples</li>
</ul>
<h2><a class="anchor" id="autotoc_md52"></a>
Drag/Drop Grid</h2>
<p>The user can place user interface elements on a grid. Other user interface elements may move when space is needed to drop an element in its place.</p>
<p>Used for placing channel faders, gain, meters on a grid custom made by the user.</p>
<ul>
<li>Snap on grid.</li>
<li>Elements should be a multiple of grid distance in height and width.</li>
</ul>
<h2><a class="anchor" id="autotoc_md53"></a>
Plug-in Element</h2>
<p>Vendors should be able to supply elements.</p>
<ul>
<li>Plug-ins may be code for Mac OS and Window, but not iOS or Android</li>
<li>Plug-ins may be a description of a combination of existing user interface elements.<ul>
<li>Custom Background image</li>
<li>Custom colours</li>
</ul>
</li>
<li>Link to networked/MIDI/etc parameters. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.0-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" width="104" height="31" alt="doxygen"/></a> 1.8.17
</small></address>
</body>
</html>
